"use strict";var loadCryptoJS=$.getScript("https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js",(function(e,t,n){console.log("crypto js file loaded")})),loadXAPIWrapper=$.getScript("https://gmdoug.sfo3.cdn.digitaloceanspaces.com/xapiwrapper-1-11.js",(function(e,t,n){console.log("xAPI wrapper file loaded")}));function setupXAPIConfig(){var e={endpoint:"https://sample-lrs-befogih.lrs.io/xapi/",auth:"Basic "+CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse("coikpi:rolzak"))},t={endpoint:"https://chat-souffle.lrs.io/xapi/",auth:"Basic "+CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse("gaodun:ujgizo"))};setupXAPIConfig.environment="development","development"===setupXAPIConfig.environment?ADL.XAPIWrapper.changeConfig(e):ADL.XAPIWrapper.changeConfig(t)}function displayDevWarningBanner(){if("development"===setupXAPIConfig.environment){var e=document.createElement("div");e.innerHTML="Using Dev LRS",e.style.backgroundColor="yellow",e.style.color="black",e.style.textAlign="center",e.style.fontWeight="bold",e.style.padding="1rem",e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.width="100%",e.style.zIndex="1000",document.body.appendChild(e)}}$.when(loadCryptoJS,loadXAPIWrapper).done((function(){setupXAPIConfig()})),$.when(loadCryptoJS,loadXAPIWrapper).done((function(){setupXAPIConfig()})),$(document).on(":passagedisplay",(function(e){setTimeout(displayDevWarningBanner,0)}));var courseUser="user"+Math.floor(89999999*Math.random()+1e7);"courseUserName"in localStorage||localStorage.setItem("courseUserName",courseUser);var actor=localStorage.getItem("courseUserName")||courseUser,actorMbox="mailto:"+actor+"@doughahn.github.io";function sendVoidStatement(e,t,n,o){var i={actor:{mbox:"mailto:"+e,name:t,objectType:"Agent"},verb:{id:"http://adlnet.gov/expapi/verbs/voided",display:{"en-US":"voided"}},object:{id:n,objectType:"StatementRef"}};ADL.XAPIWrapper.sendStatement(i,(function(e,t){o&&o(e,t)}))}function sendXAPIStatement(e,t){return ADL.XAPIWrapper.sendStatement(e,(function(e,n){if(e&&200!==e.status&&204!==e.status)console.log("xAPI statement send error:",e);else if(console.log("xAPI statement sent, response:",e.status),200===e.status||204===e.status){console.log("Statement successfully received by LRS");var o=document.getElementById(t);o&&o.classList.add("success")}else console.log("There was an issue with the statement delivery to LRS")})),console.log(JSON.stringify(e,null,"\t")),e.id}function getContextWithExperienceLevel(){var e=localStorage.getItem("selectedCategoryGroup");return{contextActivities:{category:[{id:"https://doughahn.github.io/chat-souffle/categories/experience/"+encodeURIComponent(e),objectType:"Activity",definition:{name:{"en-US":e},description:{"en-US":"A category for actors with a "+e}}}]}}}function checkOptionSelected(e){var t=document.querySelector('input[name="'+e+'-choice"]:checked'),n=document.getElementById(e+"-submit");t?n.removeAttribute("disabled"):n.setAttribute("disabled",!0)}localStorage.setItem("actor",actor),$(document).on(":passagerender",(function(e,t){var n=State.variables.devConf,o=State.variables.prodConf;if(n&&!o){var i=document.createElement("div");i.innerHTML="Using Dev LRS",i.style.backgroundColor="red",i.style.color="white",i.style.fontWeight="bold",i.style.padding="5px",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.zIndex="1000",t.content.appendChild(i)}})),window.customLinkHandler=function(e){Engine.play(e)},window.customButtonHandler=function(e){Engine.play(e)},window.checkOptionSelected=checkOptionSelected,window.setupClipboardCopy=function(){document.querySelectorAll(".copyButton").forEach((function(e){e.addEventListener("click",(function(){var e=this,t=this.previousElementSibling.innerText;navigator.clipboard.writeText(t).then((function(){console.log("Text copied to clipboard");var t=e.nextElementSibling;setTimeout((function(){t.classList.remove("show")}),1e3),e.innerText="Copied",e.classList.add("copied")})).catch((function(e){console.error("Error copying text: ",e)}))}))}))},window.updateVisitCount=function(e,t){var n=t?visited(t):visited(),o=document.getElementById(e);o?o.textContent=n:console.warn('Element with ID "'+e+'" not found.')},$.when(loadCryptoJS,loadXAPIWrapper).done((function(){$(document).on(":passagedisplay",(function(e){var t=window.currentPassage||null,n=e.passage;null!==t&&console.log("Current passage:",t.title),console.log("Incoming passage:",n.title),sendPassageLoadedStatement(t?t.title:null,n.title),window.currentPassage=n}))})),window.sendPassageLoadedStatement=function(e,t){setupXAPIConfig(),sendXAPIStatement({actor:{mbox:actorMbox,name:actor,objectType:"Agent"},verb:{id:"https://w3id.org/xapi/netc/verbs/accessed",display:{"en-US":"accessed"}},object:{id:"https://doughahn.github.io/chat-souffle/"+encodeURIComponent(t),definition:{name:{"en-US":t},description:{"en-US":"Twine game passage: "+t}},objectType:"Activity"},result:{response:e?"Accessed "+t+" from "+e:"Started at "+t}})};var ids={"history-forward":{name:"Navigation Click Forward",description:"the user clicked the forward button"},"history-backward":{name:"Navigation Click Backward",description:"the user clicked the backward button"},"menu-item-restart":{name:"Navigation Click Restart",description:"the user clicked the restart button"},"menu-item-saves":{name:"Navigation Click Saves",description:"the user clicked the saves button"}},passageName="My Passage Name";function sendButtonClickStatement(e){setupXAPIConfig();var t="doughahn@gmail.com",n=actor,o=localStorage.getItem("last"+e+"ClickStatementId");o&&sendVoidStatement(t,n,o,(function(e,t){e&&200!==e.status&&204!==e.status?console.log("xAPI void statement send error:",e):console.log("xAPI void statement sent, response:",e.status)}));var i=sendXAPIStatement({actor:{mbox:"mailto:"+t,name:n,objectType:"Agent"},verb:{id:"http://adlnet.gov/expapi/verbs/interacted",display:{"en-US":"interacted"}},object:{id:"https://doughahn.github.io/chat-souffle/"+e,definition:{name:{"en-US":e+" Click Test"},description:{"en-US":"User Interacted with the "+e+" Button."}},objectType:"Activity"},result:{response:"User clicked the "+e+" button."},context:getContextWithExperienceLevel()},e);i&&localStorage.setItem("last"+e+"ClickStatementId",i)}function sendLinkClickStatement(e){setupXAPIConfig();var t="doughahn@gmail.com",n=actor,o=localStorage.getItem("last"+e+"ClickStatementId");o&&sendVoidStatement(t,n,o,(function(e,t){e&&200!==e.status&&204!==e.status?console.log("xAPI void statement send error:",e):console.log("xAPI void statement sent, response:",e.status)}));var i=sendXAPIStatement({actor:{mbox:"mailto:"+t,name:n,objectType:"Agent"},verb:{id:"http://adlnet.gov/expapi/verbs/interacted",display:{"en-US":"interacted"}},object:{id:"https://doughahn.github.io/chat-souffle/"+e,definition:{name:{"en-US":e+" Click Test"},description:{"en-US":"User Interacted with the "+e+" Link."}},objectType:"Activity"},result:{response:"User clicked the "+e+" link."},context:getContextWithExperienceLevel()},e);i&&localStorage.setItem("last"+e+"ClickStatementId",i)}function sendFormXAPIStatement(e){setupXAPIConfig();var t="doughahn@gmail.com",n=actor,o=document.getElementById(e).dataset.parent,i=localStorage.getItem("last"+e+"StatementId");i&&sendVoidStatement(t,n,i,(function(e,t){e&&200!==e.status&&204!==e.status?console.log("xAPI void statement send error:",e):console.log("xAPI void statement sent, response:",e.status)}));var a=document.querySelector('input[name="'+e+'-choice"]:checked').value,s=a.toLowerCase().replace(/\s+/g,"-"),c={actor:{mbox:"mailto:"+t,name:n,objectType:"Agent"},verb:{id:"https://w3id.org/xapi/dod-isd/verbs/chose",display:{"en-US":"answered"}},object:{id:"https://doughahn.github.io/chat-souffle/"+e,definition:{name:{"en-US":e},description:{"en-US":"the user's choice on "+e}},objectType:"Activity"},result:{response:a},context:{contextActivities:{parent:[{id:"https://doughahn.github.io/chat-souffle/paths/"+o,objectType:"Activity",definition:{name:{"en-US":o},description:{"en-US":"The parent path of the current activity"}}}],grouping:[{id:"https://doughahn.github.io/chat-souffle/groups/"+e+"/"+s,objectType:"Activity",definition:{name:{"en-US":a+" Group"},description:{"en-US":"A group for actors who chose "+a+" on "+e}}}]}}};localStorage.setItem("selectedCategoryGroup",a);var r=sendXAPIStatement(c,e+"-submit");if(r){localStorage.setItem("last"+e+"StatementId",r);var d=document.getElementById(e+"-submit");d.classList.remove(".resubmit-success"),d.classList.add(".success");d.textContent;d.textContent="Success!",setTimeout((function(){d.textContent="Re-submit",d.classList.remove(".success"),d.classList.add(".resubmit-success")}),2e3)}}function sendFormXAPIStatementNoVoid(e){setupXAPIConfig();var t=actor,n=document.getElementById(e).dataset.parent,o=document.querySelector('input[name="'+e+'-choice"]:checked').value,i=o.toLowerCase().replace(/\s+/g,"-"),a={actor:{mbox:"mailto:doughahn@gmail.com",name:t,objectType:"Agent"},verb:{id:"https://w3id.org/xapi/dod-isd/verbs/chose",display:{"en-US":"answered"}},object:{id:"https://doughahn.github.io/chat-souffle/"+e,definition:{name:{"en-US":e},description:{"en-US":"the user's choice on "+e}},objectType:"Activity"},result:{response:o},context:{contextActivities:{parent:[{id:"https://doughahn.github.io/chat-souffle/paths/"+n,objectType:"Activity",definition:{name:{"en-US":n},description:{"en-US":"The parent path of the current activity"}}}],grouping:[{id:"https://doughahn.github.io/chat-souffle/groups/"+e+"/"+i,objectType:"Activity",definition:{name:{"en-US":o+" Group"},description:{"en-US":"A group for actors who chose "+o+" on "+e}}}]}}};localStorage.setItem("selectedCategoryGroup",o);var s=sendXAPIStatement(a,e+"-submit");if(s){localStorage.setItem("last"+e+"StatementId",s);var c=document.getElementById(e+"-submit");c.classList.remove(".resubmit-success"),c.classList.add(".success");c.textContent;c.textContent="Success!",setTimeout((function(){c.textContent="Re-submit",c.classList.remove(".success"),c.classList.add(".resubmit-success")}),2e3)}}function sendTextareaXAPIStatement(e,t,n){console.log("activityId: ",n),setupXAPIConfig();var o=actor,i=document.getElementById(e).value,a=document.getElementById(e).parentNode.dataset.parent;sendXAPIStatement({actor:{mbox:"mailto:doughahn@gmail.com",name:o,objectType:"Agent"},verb:{id:"http://adlnet.gov/expapi/verbs/answered",display:{"en-US":"answered"}},object:{id:"https://doughahn.github.io/chat-souffle/"+n,definition:{name:{"en-US":n},description:{"en-US":"Answered "+n}},objectType:"Activity"},result:{response:i},context:{contextActivities:{grouping:[{id:"https://doughahn.github.io/chat-souffle/paths/"+a,objectType:"Activity",definition:{name:{"en-US":a},description:{"en-US":"The parent path of the current activity"}}}]}}},t),document.getElementById(t).disabled=!0}function checkTextareaNotEmpty(e,t){var n=document.getElementById(e).value,o=document.getElementById(t);0===n.length?o.disabled=!0:o.disabled=!1}function attachExternalLinkEventListener(){$(".external-link").each((function(){$(this).on("click",(function(e){e.preventDefault();var t=$(this).attr("id");window.sendExternalLinkClickStatement(t),window.open($(this).attr("href"),"_blank")}))}))}Object.keys(ids).forEach((function(e){document.getElementById(e).addEventListener("click",(function(){var t=passage(),n=ids[e].description+" from "+t;setupXAPIConfig(),sendXAPIStatement({actor:{mbox:"mailto:doughahn@gmail.com",name:actor,objectType:"Agent"},verb:{id:"https://w3id.org/xapi/dod-isd/verbs/interacted",display:{"en-US":"answered"}},object:{id:"https://doughahn.github.io/chat-souffle/"+e,definition:{name:{"en-US":ids[e].name},description:{"en-US":ids[e].description}},objectType:"Activity"},result:{response:n}}),console.log(n)}))})),window.handleButtonStartSurvey1=function(){sendButtonClickStatement("buttonStartSurvey1")},window.handleButtonSurvey1to2=function(){sendButtonClickStatement("survey-1-submit")},window.handleButtonSurvey2to3=function(){sendButtonClickStatement("survey-2-submit")},window.handleButtonSurvey3toText=function(){sendButtonClickStatement("survey-3-submit")},document.addEventListener("DOMContentLoaded",(function(){document.getElementById("self-assess-more-feedback").addEventListener("click",(function(){sendLinkClickStatement("self-assess-more-feedback")})),document.getElementById("self-assess-early-exit").addEventListener("click",(function(){sendLinkClickStatement("self-assess-early-exit")})),document.getElementById("provided-criteria").addEventListener("click",(function(){sendLinkClickStatement("provided-criteria")}))})),window.send_completion=function(){setupXAPIConfig();var e="doughahn@gmail.com",t=actor,n=localStorage.getItem("lastTestButtonClickStatementId");n&&sendVoidStatement(e,t,n,(function(e,t){e&&200!==e.status&&204!==e.status?console.log("xAPI void statement send error:",e):console.log("xAPI void statement sent, response:",e.status)}));var o=sendXAPIStatement({actor:{mbox:"mailto:"+e,name:t,objectType:"Agent"},verb:{id:"http://adlnet.gov/expapi/verbs/interacted",display:{"en-US":"completed"}},object:{id:"https://doughahn.github.io/chat-souffle/completed-self-assessment-early-release",definition:{name:{"en-US":"Completed Self Assessment on early release"},description:{"en-US":"User Completed Self Assessment on early release."}},objectType:"Activity"},result:{response:"User Completed Self Assessment on early release."},context:getContextWithExperienceLevel()},"completedButton");o&&(localStorage.setItem("completedButton",o),document.getElementById("completedButton").disabled=!0)},window.sendFormXAPIStatement=sendFormXAPIStatement,window.sendFormXAPIStatementNoVoid=sendFormXAPIStatementNoVoid,window.sendTextareaXAPIStatement=sendTextareaXAPIStatement,window.checkTextareaNotEmpty=checkTextareaNotEmpty,setup.trackStarts=0,setup.trackCompletions=0,setup.iterationActivities={},setup.currentIterationId=null,setup.trackStartsTrack2=0,Config.saves.onSave=function(e){e.metadata.iterationActivities=setup.iterationActivities},Config.saves.onLoad=function(e){e.metadata.iterationActivities&&(setup.iterationActivities=e.metadata.iterationActivities)},window.handleXAPIClick=function(e){var t=e.target.id;window.handleButtonClick(t)},window.handleButtonClick=function(e){setup.currentIterationId="iteration_"+(setup.trackStarts+1),window.incrementTrackCompletions(setup.currentIterationId,e)},window.incrementTrackCompletions=function(e,t){(setup.trackCompletions++,console.log("Track completions: "+setup.trackCompletions),e)&&sendXAPIStatement({actor:{mbox:"mailto:learner@example.com"},verb:{id:"https://w3id.org/xapi/adb/verbs/completed",display:{"en-US":"completed"}},object:{id:"https://example.com/tracks/"+e+"/button/"+t,definition:{name:{"en-US":"Track "+e+" - Button "+t},description:{"en-US":"Loop # "+setup.trackCompletions+" completed"}}}})},window.addCompleteTrackListener=function(){for(var e=document.getElementsByClassName("complete-track-1"),t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var t=e.target.id;window.handleButtonClick(t)}))},window.handleButtonClickTrack2=function(e){setup.currentIterationId="iteration_track2_"+(setup.trackStarts+1),window.incrementTrackCompletions(setup.currentIterationId,e)},window.handleXAPIClickTrack2=function(e){var t=e.target.id;window.handleButtonClickTrack2(t)},window.sendExternalLinkClickStatement=function(e){var t=document.getElementById(e).href;setupXAPIConfig();var n=actor,o=(localStorage.getItem("last"+e+"ClickStatementId"),sendXAPIStatement({actor:{mbox:"mailto:doughahn@gmail.com",name:n,objectType:"Agent"},verb:{id:"http://adlnet.gov/expapi/activities/link",display:{"en-US":"link"}},object:{id:"https://doughahn.github.io/chat-souffle/"+e,definition:{name:{"en-US":e},description:{"en-US":"User linked the "+e+" Link."}},objectType:"Activity"},result:{response:"User linked the "+e+" link with URL: "+t}},e));o&&localStorage.setItem("last"+e+"ClickStatementId",o)},$(document).on(":passagedisplay",(function(){console.log("Passage displayed"),attachExternalLinkEventListener()}));